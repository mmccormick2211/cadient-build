{
    "description": "Base install of Windows 2016 Standard (1607)",
    "min_packer_version": "",
    "variables": {
        "build_timestamp": "{{isotime \"20060102-1504\"}}",
        "mirror": "https://software-download.microsoft.com",
        "mirror_directory": "download/pr",
        "iso_name": "Windows_Server_2016_Datacenter_EVAL_en-us_14393_refresh.ISO",
        "iso_checksum": "772700802951b36c8cb26a61c040b9a8dc3816a3",
        "iso_checksum_type": "sha1",
        "box_basename": "win2016",
        "template": "{{user `box_basename`}}-std-base",
        "vm_name": "packer-{{user `template`}}-vmware",
        "guest_os_type": "windows9srv-64",
        "headless": "false",
        "cpus": "2",
        "memory": "4096",
        "disk_size": "32767",
        "packer_output": "D:/PACKER_BUILDS",
        "vagrant_output": "D:/VAGRANT_BOXES"
    },
    "builders": [{
        "type": "vmware-iso",
        "name": "{{user `box_basename`}}",
        "iso_url": "{{user `mirror`}}/{{user `mirror_directory`}}/{{user `iso_name`}}",
        "iso_checksum": "{{user `iso_checksum`}}",
        "iso_checksum_type": "{{user `iso_checksum_type`}}",
        "output_directory": "{{user `packer_output`}}/{{user `vm_name`}}",
        "vm_name": "{{user `vm_name`}}",
        "guest_os_type": "{{user `guest_os_type`}}",
        "headless": "{{user `headless`}}",
        "cpus": "{{user `cpus` }}",
        "cores": 1,
        "memory": "{{user `memory` }}",
        "network": "nat",
        "disk_size": "{{user `disk_size`}}",
        "disk_adapter_type": "lsisas1068",
        "disk_type_id": "4",
        "parallel": "NONE",
        "serial": "NONE",
        "sound": false,
        "usb": false,
        "vmx_remove_ethernet_interfaces": false,
        "floppy_files": [
            "answer_files/{{user `box_basename`}}/Autounattend.xml",
            "scripts/1build/Enable-WinRM.cmd"
        ],
        "communicator": "winrm",
        "winrm_username": "vagrant",
        "winrm_password": "vagrant",
        "winrm_timeout": "12h",
        "shutdown_command": "shutdown /s /t 10 /f /d p:4:1 /c \"Packer Shutdown\"",
        "shutdown_timeout": "15m"
    }],
    "provisioners": [{
            "pause_before": "2m",
            "type": "windows-shell",
            "scripts": [
                "scripts/2provision/Install-VagrantSSL.cmd",
                "scripts/2provision/Remove-SystemDriveLetter.cmd",
                "scripts/2provision/Customize-Windows.cmd",
                "scripts/2provision/Install-Chocolatey.cmd"
            ]
        },
        {
            "type": "powershell",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "valid_exit_codes": [
                0,
                1605,
                1614,
                1641,
                3010
            ],
            "inline": [
                "'############### Chocolatey Package Manager Configuration Block ###############'",
                "#choco config  set     --name='proxy'         --value=''",
                "#choco config  set     --name='proxyUser'     --value=''",
                "#choco config  set     --name='proxyPassword' --value=''",
                "choco feature enable  --name='usePackageExitCodes'",
                "choco feature enable  --name='useRememberedArgumentsForUpgrades'",
                "choco feature enable  --name='stopOnFirstPackageFailure'",
                "choco feature enable  --name='logWithoutColor'",
                "choco feature disable --name='showDownloadProgress'",
                "choco upgrade 7zip    --acceptlicense --yes"
            ]
        },
        {
            "type": "windows-restart",
            "timeout": "20m"
        },
        {
            "type": "powershell",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "valid_exit_codes": [
                0,
                1605,
                1614,
                1641,
                3010
            ],
            "inline": [
                "'############### Windows Features Installation ###############'",
                "choco install   MicrosoftWindowsPowerShellRoot --source='WindowsFeatures'",
                "choco install   MicrosoftWindowsPowerShell     --source='WindowsFeatures'",
                "choco install   MicrosoftWindowsPowerShellV2   --source='WindowsFeatures'",
                "choco install   NetFx3ServerFeatures           --source='WindowsFeatures'",
                "choco install   NetFx3                         --source='WindowsFeatures'",
                "choco install   NetFx4ServerFeatures           --source='WindowsFeatures'",
                "choco install   NetFx4                         --source='WindowsFeatures'",
                "choco install   SMB1Protocol                   --source='WindowsFeatures'",
                "choco install   TelnetClient                   --source='WindowsFeatures'",
                "choco install   TFTP                           --source='WindowsFeatures'",
                "choco install   Xps-Foundation-Xps-Viewer      --source='WindowsFeatures'",
                "#",
                "choco uninstall MicrosoftWindowsPowerShellISE  --source='WindowsFeatures'",
                "choco uninstall SearchEngine-Client-Package    --source='WindowsFeatures'",
                "choco uninstall Windows-Defender               --source='WindowsFeatures'",
                "choco uninstall Windows-Defender-Gui           --source='WindowsFeatures'",
                "choco uninstall Windows-Defender-Features      --source='WindowsFeatures'",
                "#"
            ]
        },
        {
            "type": "windows-restart",
            "timeout": "20m"
        },
        {
            "type": "powershell",
            "elevated_user": "vagrant",
            "elevated_password": "vagrant",
            "valid_exit_codes": [
                0,
                1605,
                1614,
                1641,
                3010
            ],
            "inline": [
                "'############### Base Applications Installation ###############'",
                "#choco upgrade chef-client                --acceptlicense --yes",
                "#choco upgrade puppet-agent               --acceptlicense --yes",
                "#choco upgrade salt-minion                --acceptlicense --yes",
                "choco upgrade dotnetfx --version 4.5.2.0 --acceptlicense --yes",
                "choco upgrade powershell                 --acceptlicense --yes",
                "choco upgrade sysinternals               --acceptlicense --yes",
                "choco upgrade ultradefrag                --acceptlicense --yes",
                "choco upgrade vmware-tools               --acceptlicense --yes",
                "choco upgrade abc-update                 --acceptlicense --yes",
                "#iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/DarwinJS/ChocoPackages/master/openssh/InstallChoco_and_win32-openssh_with_server.ps1'))",
                "#"
            ]
        },
        {
            "type": "windows-restart",
            "timeout": "20m"
        },
        {
            "type": "breakpoint",
            "note": "foo bar baz",
            "disable": "false"
        }
    ],
    "post-processors": [
        [{
                "type": "vsphere",
                "datacenter": "PDX",
                "cluster": "Production",
                "datastore": "[prd_fc_ds09]",
                "host": "prd-vmw-vc1.corp.unicru.com",
                "username": "mmccormick1@unicru.com",
                "password": "Amber614",
                "vm_name": "{{user `vm_name`}}",
                "vm_folder": "{{user `vm_name`}}",
                "vm_network": "23-svcapp2",
                "disk_mode": "thin",
                "insecure": true,
                "keep_input_artifact": true
            },
            {
                "type": "vsphere-template",
                "host": "prd-vmw-vc1.corp.unicru.com",
                "insecure": true,
                "username": "mmccormick1@unicru.com",
                "password": "Amber614"
            }
        ]
    ]
}